function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:30.3071816,lng:-97.7559964},zoom:13,styles:style,mapTypeControl:!1});for(var e=[{title:"North Loop",location:{lat:30.318867,lng:-97.718588}},{title:"Central Austin",location:{lat:30.296171,lng:-97.738954}},{title:"Downtown Austin",location:{lat:30.272921,lng:-97.744386}},{title:"East Austin",location:{lat:30.274415,lng:-97.715923}},{title:"South Lamar",location:{lat:30.236265,lng:-97.782422}}],t=new google.maps.InfoWindow,o=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_LEFT,drawingModes:[google.maps.drawing.OverlayType.POLYGON]}}),n=makeMarkerIcon("0091ff"),i=makeMarkerIcon("ffff24"),a=0;a<e.length;a++){var s=e[a].location,r=e[a].title,l=new google.maps.Marker({position:s,title:r,icon:n,animation:google.maps.Animation.DROP,id:a});markers.push(l),l.addListener("click",function(){populateInfoWindow(this,t)}),l.addListener("mouseover",function(){this.setIcon(i)}),l.addListener("mouseout",function(){this.setIcon(n)})}document.getElementById("show-listings").addEventListener("click",showListings),document.getElementById("hide-listings").addEventListener("click",hideListings),document.getElementById("toggle-drawing").addEventListener("click",function(){toggleDrawing(o)}),document.getElementById("zoom-to-area").addEventListener("click",function(){zoomToArea()}),document.getElementById("search-within-time").addEventListener("click",function(){searchWithinTime()}),o.addListener("overlaycomplete",function(e){polygon&&(polygon.setMap(null),hideListings()),o.setDrawingMode(null),polygon=e.overlay,polygon.setEditable(!0),searchWithinPolygon(),polygon.getPath().addListener("set_at",searchWithinPolygon),polygon.getPath().addListener("insert_at",searchWithinPolygon)})}function populateInfoWindow(e,t){function o(o,n){if(n==google.maps.StreetViewStatus.OK){var i=o.location.latLng,a=google.maps.geometry.spherical.computeHeading(i,e.position);t.setContent("<div>"+e.title+'</div><div id="pano"></div>');var s={position:i,pov:{heading:a,pitch:30}};new google.maps.StreetViewPanorama(document.getElementById("pano"),s)}else t.setContent("<div>"+e.title+"</div><div>No Street View Found</div>")}if(t.marker!=e){t.setContent(""),t.marker=e,t.addListener("closeclick",function(){t.marker=null});(new google.maps.StreetViewService).getPanoramaByLocation(e.position,50,o),t.open(map,e)}}function showListings(){for(var e=new google.maps.LatLngBounds,t=0;t<markers.length;t++)markers[t].setMap(map),e.extend(markers[t].position);map.fitBounds(e)}function hideListings(){for(var e=0;e<markers.length;e++)markers[e].setMap(null)}function makeMarkerIcon(e){return new google.maps.MarkerImage("http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+e+"|40|_|%E2%80%A2",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34))}function toggleDrawing(e){e.map?(e.setMap(null),polygon&&polygon.setMap(null)):e.setMap(map)}function searchWithinPolygon(){for(var e=0;e<markers.length;e++)google.maps.geometry.poly.containsLocation(markers[e].position,polygon)?markers[e].setMap(map):markers[e].setMap(null)}function zoomToArea(){var e=new google.maps.Geocoder,t=document.getElementById("zoom-to-area-text").value;""===t?window.alert("You must enter an area, or address"):e.geocode({address:t,componentRestrictions:{locality:"Austin"}},function(e,t){t==google.maps.GeocoderStatus.OK?(map.setCenter(e[0].geometry.location),map.setZoom(15)):window.alert("We could not find that location - try entering a morespecfic place")})}function searchWithinTime(){var e=new google.maps.DistanceMatrixService,t=document.getElementById("search-within-time-text").value;if(""===t)window.alert("You must enter an address.");else{hideListings();for(var o=[],n=0;n<markers.length;n++)o[n]=markers[n].position;var i=t,a=document.getElementById("mode").value;e.getDistanceMatrix({origins:o,destinations:[i],travelMode:google.maps.TravelMode[a],unitSystem:google.maps.UnitSystem.IMPERIAL},function(e,t){t!==google.maps.DistanceMatrixStatus.OK?window.alert("Error was: "+t):displayMarkersWithinTime(e)})}}function displayMarkersWithinTime(e){for(var t=document.getElementById("max-duration").value,o=e.originAddress,n=(e.destinationAddresses,!1),i=0;i<o.length;i++)for(var a=e.rows[i].elements,s=0;s<a.length;s++){var r=a[s];if("OK"===r.status){var l=r.distance.text,g=r.duration.value/60,d=r.duration.text;if(g<=t){markers[i].setMap(map),n=!0;var m=new google.maps.InfoWindow({content:d+" away, "+l+'<div><button type="button" value="View Route" onclick="displayDirections(&quot;'+o[i]+'&quot;) ;">View Route</button></div>'});m.open(map,markers[i]),markers[i].infowindow=m,google.maps.event.addListener(markers[i],"click",function(){this.infowindow.close()})}}}n||window.alert("We could not find any locations within that distance!")}function displayDirections(e){hideListings();var t=new google.maps.DirectionsService,o=document.getElementById("search-within-time-text").value,n=document.getElementById("mode").value;t.route({origin:e,destination:o,travelMode:google.maps.TravelMode[n]},function(e,t){if(t===google.maps.DirectionsStatus.OK){new google.maps.DirectionsRenderer({map:map,directions:e,draggble:!0,polylineOptions:{strokeColor:"greeen"}})}else window.alert("Directions request failed due to "+t)})}var map,markers=[],polygon=null,style=[{featureType:"water",stylers:[{color:"#19a0d8"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#e85113"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efe9e4"},{lightness:-40}]},{featureType:"transit.station",stylers:[{weight:9},{hue:"#e85113"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{lightness:100}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:-100}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"on"},{color:"#f0e4d3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#efe9e4"},{lightness:-25}]}];